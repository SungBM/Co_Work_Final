<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.naver.cowork.mybatis.mapper.NoticeMapper">

	<select id="getListCount" resultType="int">
		select count(*) from notice
	</select>
	
	<select id="getNoticeList" parameterType="map" resultType="notice">
		select * from
			(select rownum rnum, b.*
			 from
				(select * from notice
				 order by notice_re_ref desc,
				 notice_re_seq asc) b
			 where rownum &lt; #{end}
			)
		where rnum &gt;= #{start} and rnum &lt;= #{end}
	</select>
	
	<select id="getNoticeDetail" parameterType="int" resultType="notice">
		select *
		from	notice
		where	NOTICE_NUM=#{number}
	</select>	
	
	<insert id="insertNotice" parameterType="notice">
		<selectKey resultType="int"	order="BEFORE"	keyProperty="NOTICE_NUM">
		 select nvl(max(NOTICE_NUM),0)+1 from notice
		</selectKey>
		insert into notice
	 	(NOTICE_NUM,
	 	 USER_ID, NOTICE_SUBJECT,
	 	 NOTICE_CONTENT, NOTICE_FILE, NOTICE_ORIGINAL,
	 	 NOTICE_RE_REF,
	 	 NOTICE_RE_LEV, NOTICE_RE_SEQ, NOTICE_READCOUNT,
	 	 NOTICE_REG_DATE)
	 	 values
	 	 (#{NOTICE_NUM},
	 	  #{USER_ID}, #{NOTICE_SUBJECT},
	 	  #{NOTICE_CONTENT}, #{NOTICE_FILE, jdbcType=VARCHAR}, #{NOTICE_ORIGINAL, jdbcType=VARCHAR},
	 	  #{NOTICE_NUM},
	 	  #{NOTICE_RE_LEV}, #{NOTICE_RE_SEQ}, #{NOTICE_READCOUNT},
	 	    sysdate)
	</insert>

	<update id="setReadCountUpdate" parameterType="int">
		update	notice
		set		NOTICE_READCOUNT=NOTICE_READCOUNT+1
		where	NOTICE_NUM=#{number}
	</update>
	 
	 <update id="noticeModify" parameterType="notice">
	 	update notice
	 	set
	 		NOTICE_SUBJECT=#{NOTICE_SUBJECT},
	 		NOTICE_CONTENT=#{NOTICE_CONTENT},
	 		NOTICE_FILE=#{NOTICE_FILE, jdbcType=VARCHAR},
	 		NOTICE_ORIGINAL=#{NOTICE_ORIGINAL, jdbcType=VARCHAR}
	 	where NOTICE_NUM=#{NOTICE_NUM}
	 </update>
	
		 <delete id="noticeDelete" parameterType="notice">
	  	delete from notice
			where NOTICE_RE_REF = #{NOTICE_RE_REF}
			and 	 NOTICE_RE_LEV >= #{NOTICE_RE_LEV}
			and 	 NOTICE_RE_SEQ >= #{NOTICE_RE_SEQ}
	 </delete>

</mapper>