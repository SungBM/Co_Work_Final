<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.naver.cowork.mybatis.mapper.EDMSMapper">

    <select id="getMyDoc" resultType="edms">
        select rn,
               DOCUMENT_FORM_CODE,
               DOCUMENT_TITLE,
               DOCUMENT_CATEGORY_NUM,
               DOCUMENT_FORM_DATE,
               DOCUMENT_STATE,
               approval_date,
               approval_state,
               USER_NAME,
               dept_name,
               job_name
        from (select rownum rn,
                     z.DOCUMENT_FORM_CODE,
                     z.DOCUMENT_TITLE,
                     z.DOCUMENT_CATEGORY_NUM,
                     z.DOCUMENT_FORM_DATE,
                     z.DOCUMENT_STATE,
                     z.approval_date,
                     z.approval_state,
                     z.USER_NAME,
                     z.dept_name,
                     z.job_name

              from (select d.DOCUMENT_FORM_CODE,
                           d.DOCUMENT_TITLE,
                           d.DOCUMENT_CATEGORY_NUM,
                           d.DOCUMENT_FORM_DATE,
                           d.DOCUMENT_STATE,
                           a.approval_date,
                           a.approval_state,
                           u.USER_NAME,
                           d.dept_name,
                           j.job_name
                    from DOCUMENT_FORM d
                             inner join approval_line a
                                        on a.document_no = d.document_form_code AND a.approval_level = d.approval_level
                             inner join user_info u
                                        on a.approval_user_id = u.user_id
                             inner join dept d
                                        on u.user_dept = d.dept_no
                             inner join job j
                                        on u.user_job = j.job_no
                    where d.user_id = #{user_id}
                    order by DOCUMENT_FORM_DATE ASC) z)

		<![CDATA[
		where rn > #{skip}
          and rn <= #{viewSize} * #{pageNum}
        ]]>
    </select>

    <select id="getMyDocApp" resultType="edms">
        <![CDATA[
        select rn,
               DOCUMENT_CATEGORY_NUM,
               DOCUMENT_TITLE,
               DOCUMENT_FORM_CODE,
               USER_NAME,
               dept_name,
               job_name,
               DOCUMENT_FORM_DATE,
               approval_level,
               approval_date
        from (select rownum rn,
                     z.DOCUMENT_CATEGORY_NUM,
                     z.DOCUMENT_TITLE,
                     z.DOCUMENT_FORM_CODE,
                     z.USER_NAME,
                     z.dept_name,
                     z.job_name,
                     z.DOCUMENT_FORM_DATE,
                     z.approval_level,
                     z.approval_date
              from (select d.DOCUMENT_CATEGORY_NUM,
                           d.DOCUMENT_TITLE,
                           d.DOCUMENT_FORM_CODE,
                           u.USER_NAME,
                           d.dept_name,
                           j.job_name,
                           d.DOCUMENT_FORM_DATE,
                           a.approval_level,
                           a.approval_date

                    from DOCUMENT_FORM d
                             inner join approval_line a
                                        on a.document_no = d.document_form_code AND a.approval_level <= d.approval_level

                             inner join user_info u
                                        on a.approval_user_id = u.user_id
                             inner join dept d
                                        on u.user_dept = d.dept_no
                             inner join job j
                                        on u.user_job = j.job_no
                    where a.approval_user_id = #{user_id}
                    order by DOCUMENT_FORM_DATE ASC) z)

        where rn > #{skip}
          and rn <= #{viewSize} * #{pageNum}
        ]]>
    </select>

    <select id="getCountDoc" resultType="int">
        select COUNT(d.DOCUMENT_FORM_CODE)
        from DOCUMENT_FORM d
                 inner join approval_line a
                            on a.document_no = d.document_form_code AND a.approval_level = d.approval_level
                 inner join user_info u
                            on a.approval_user_id = u.user_id
                 inner join dept d
                            on u.user_dept = d.dept_no
                 inner join job j
                            on u.user_job = j.job_no
        where d.user_id = #{user_id}
    </select>

    <select id="getCountDocApp" resultType="int">
        <![CDATA[
        select COUNT(d.DOCUMENT_CATEGORY_NUM)
        from DOCUMENT_FORM d
                 inner join approval_line a
                            on a.document_no = d.document_form_code AND a.approval_level <= d.approval_level

                 inner join user_info u
                            on a.approval_user_id = u.user_id
                 inner join dept d
                            on u.user_dept = d.dept_no
                 inner join job j
                            on u.user_job = j.job_no
        where a.approval_user_id = #{user_id}
        ]]>
    </select>

    <select id="getAppLine" resultType="edms">
        select u.user_name, j.job_name, d.dept_name, a.approval_state, a.approval_date
        from approval_line a
                 inner join user_info u
                            on u.user_id = a.approval_user_id
                 inner join dept d
                            on u.user_dept = d.dept_no
                 inner join job j
                            on u.user_job = j.job_no
        where a.document_no = #{document_no}
        ORDER BY a.APPROVAL_LEVEL ASC
    </select>



</mapper>